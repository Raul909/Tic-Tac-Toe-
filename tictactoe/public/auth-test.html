<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auth Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #000510; color: #fff; }
    input, button { display: block; margin: 10px 0; padding: 10px; }
    button { background: #00d4ff; border: none; color: #000; cursor: pointer; }
    .error { color: #ff6b35; margin: 10px 0; }
    .success { color: #4dffdb; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>Registration Test</h1>
  
  <h2>Register</h2>
  <input type="text" id="reg-user" placeholder="Username (3-16 chars)">
  <input type="password" id="reg-pass" placeholder="Password (min 8 chars)">
  <button onclick="testRegister()">Register</button>
  <div id="reg-result"></div>
  
  <h2>Login</h2>
  <input type="text" id="login-user" placeholder="Username">
  <input type="password" id="login-pass" placeholder="Password">
  <button onclick="testLogin()">Login</button>
  <div id="login-result"></div>

  <script>
    async function testRegister() {
      const username = document.getElementById('reg-user').value.trim();
      const password = document.getElementById('reg-pass').value;
      const resultDiv = document.getElementById('reg-result');
      
      if (!username || !password) {
        resultDiv.className = 'error';
        resultDiv.textContent = 'Please fill all fields';
        return;
      }
      
      try {
        const response = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (data.ok) {
          resultDiv.className = 'success';
          resultDiv.textContent = '✅ Registration successful! Token: ' + data.token.substring(0, 8) + '...';
          console.log('Full response:', data);
        } else {
          resultDiv.className = 'error';
          resultDiv.textContent = '❌ Error: ' + data.error;
        }
      } catch (error) {
        resultDiv.className = 'error';
        resultDiv.textContent = '❌ Network error: ' + error.message;
      }
    }
    
    async function testLogin() {
      const username = document.getElementById('login-user').value.trim();
      const password = document.getElementById('login-pass').value;
      const resultDiv = document.getElementById('login-result');
      
      if (!username || !password) {
        resultDiv.className = 'error';
        resultDiv.textContent = 'Please fill all fields';
        return;
      }
      
      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        
        if (data.ok) {
          resultDiv.className = 'success';
          resultDiv.textContent = '✅ Login successful! Welcome ' + data.username;
          console.log('Full response:', data);
        } else {
          resultDiv.className = 'error';
          resultDiv.textContent = '❌ Error: ' + data.error;
        }
      } catch (error) {
        resultDiv.className = 'error';
        resultDiv.textContent = '❌ Network error: ' + error.message;
      }
    }
  </script>
</body>
</html>
